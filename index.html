<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Birthday Rescue Mission</title>
    <style>
        body {
            margin: 0;
            background: black;
            overflow: hidden;
        }

        canvas {
            display: block;
            margin: auto;
            background: linear-gradient(#001122, #003366);
        }
    </style>
</head>

<body>

    <canvas id="game" width="800" height="450"></canvas>

    <script>
        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");

        let state = "start";

        let hero = { x: 50, y: 200, size: 20, speed: 4 };
        let shadow = { x: 600, y: 200, size: 30, dir: 1 };
        let parents = { x: 700, y: 200 };

        let crystals = [
            { x: 200, y: 100, collected: false },
            { x: 400, y: 300, collected: false },
            { x: 600, y: 150, collected: false }
        ];

        let keys = {};
        let gamepadIndex = null;
        let collectedCount = 0;

        window.addEventListener("keydown", e => keys[e.key] = true);
        window.addEventListener("keyup", e => keys[e.key] = false);

        window.addEventListener("gamepadconnected", e => {
            gamepadIndex = e.gamepad.index;
        });

        function getInput() {
            let dx = 0, dy = 0, action = false;

            if (keys["ArrowLeft"]) dx = -1;
            if (keys["ArrowRight"]) dx = 1;
            if (keys["ArrowUp"]) dy = -1;
            if (keys["ArrowDown"]) dy = 1;
            if (keys["Enter"]) action = true;

            if (gamepadIndex != null) {
                let gp = navigator.getGamepads()[gamepadIndex];
                if (gp) {
                    dx = gp.axes[0];
                    dy = gp.axes[1];
                    action = gp.buttons[0].pressed;
                }
            }

            return { dx, dy, action };
        }

        function drawHero() {
            ctx.fillStyle = "pink";
            ctx.beginPath();
            ctx.arc(hero.x, hero.y, hero.size, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = "white";
            ctx.fillText("YOU", hero.x - 10, hero.y - 30);
        }

        function drawShadow() {
            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.arc(shadow.x, shadow.y, shadow.size, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = "red";
            ctx.fillText("EVIL", shadow.x - 15, shadow.y - 40);
        }

        function drawParents() {
            ctx.fillStyle = "lightblue";
            ctx.fillRect(parents.x, parents.y, 30, 30);
            ctx.fillText("Mom & Dad", parents.x - 20, parents.y - 10);
        }

        function drawCrystals() {
            crystals.forEach(c => {
                if (!c.collected) {
                    ctx.fillStyle = "yellow";
                    ctx.fillRect(c.x, c.y, 15, 15);
                }
            });
        }

        function updateGame() {

            let input = getInput();

            hero.x += input.dx * hero.speed;
            hero.y += input.dy * hero.speed;

            shadow.y += shadow.dir * 2;
            if (shadow.y < 50 || shadow.y > 400) shadow.dir *= -1;

            crystals.forEach(c => {
                if (!c.collected && dist(hero, c) < 20) {
                    c.collected = true;
                    collectedCount++;
                }
            });

            if (dist(hero, shadow) < 30) {
                hero.x = 50;
                hero.y = 200;
            }

            if (collectedCount == 3 && dist(hero, parents) < 40) {
                state = "win";
            }
        }

        function dist(a, b) {
            return Math.hypot(a.x - b.x, a.y - b.y);
        }

        function drawStart() {
            ctx.fillStyle = "white";
            ctx.font = "30px Arial";
            ctx.fillText("RESCUE MISSION", 260, 150);

            ctx.font = "20px Arial";
            ctx.fillText("Collect Love Crystals", 290, 200);
            ctx.fillText("Save Mom & Dad", 320, 230);
            ctx.fillText("Press Enter / A to Start", 280, 300);

            if (getInput().action) {
                state = "game";
            }
        }

        function drawGame() {
            drawCrystals();
            drawParents();
            drawShadow();
            drawHero();

            ctx.fillStyle = "white";
            ctx.fillText("Crystals: " + collectedCount + "/3", 10, 20);
        }

        function drawWin() {

            ctx.fillStyle = "white";
            ctx.font = "28px Arial";
            ctx.fillText("YOU SAVED MOM & DAD!", 220, 140);

            ctx.font = "24px Arial";
            ctx.fillText("HAPPY BIRTHDAY!", 300, 200);

            ctx.font = "18px Arial";
            ctx.fillText("We love you forever.", 300, 240);
            ctx.fillText("May all your dreams come true.", 250, 270);
            ctx.fillText("You are our hero.", 310, 300);
        }

        function loop() {

            ctx.clearRect(0, 0, 800, 450);

            if (state == "start") drawStart();
            if (state == "game") { updateGame(); drawGame(); }
            if (state == "win") drawWin();

            requestAnimationFrame(loop);
        }

        ctx.font = "16px Arial";
        loop();

    </script>

</body>

</html>